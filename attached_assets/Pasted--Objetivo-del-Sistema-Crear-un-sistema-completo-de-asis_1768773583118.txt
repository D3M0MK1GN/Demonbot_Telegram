üéØ Objetivo del Sistema
Crear un sistema completo de asistencia para v√≠ctimas de delitos inform√°ticos que incluya:

Bot conversacional en Telegram para registro de casos
Backend API RESTful con FastAPI
Base de datos PostgreSQL robusta
Dashboard web en tiempo real para monitoreo


üèóÔ∏è Arquitectura del Sistema
Stack Tecnol√≥gico:

Bot: Python + python-telegram-bot
Backend API: Python + FastAPI
Base de Datos: PostgreSQL 14+
Dashboard: React + Recharts + TailwindCSS
WebSockets: Para actualizaci√≥n en tiempo real
Contenedores: Docker + Docker Compose
Web Server: Nginx


üìä Base de Datos PostgreSQL
Tablas Principales:

users - Informaci√≥n de usuarios/v√≠ctimas

ID, telegram_id, nombre_completo, c√©dula, edad, profesi√≥n, lugar_residencia, tel√©fono
Timestamps: created_at, updated_at


cases - Casos registrados

ID, user_id, numero_caso (√∫nico auto-generado)
tipo_delito (ENUM: phishing, hackeo_whatsapp, hackeo_email, extorsi√≥n, etc.)
estado (ENUM: nuevo, en_proceso, denunciado, resuelto, cerrado)
descripcion_hechos, fecha_incidente, monto_perdido
numero_sospechoso, entidad_bancaria
compartio_codigo_otp, realizo_transferencias
aplicacion_comprometida, dispositivo_afectado
pais, ciudad


evidences - Evidencias adjuntas

ID, case_id, tipo (captura_pantalla, documento, url_maliciosa, audio, video)
file_path, file_id, descripcion


bot_interactions - Log de interacciones

ID, user_id, telegram_id, mensaje, tipo_accion, metadata (JSONB)
timestamp


reported_numbers - N√∫meros telef√≥nicos reportados

ID, numero, veces_reportado, tipo_fraude, pais_origen
ultima_fecha_reporte


active_sessions - Sesiones activas del bot

ID, telegram_id, user_id, estado_conversacion
datos_temporales (JSONB), ultima_actividad



Vistas para Analytics:

dashboard_stats - Estad√≠sticas generales
casos_por_tipo - Distribuci√≥n por tipo de delito
top_numeros_reportados - N√∫meros m√°s reportados

Funciones Autom√°ticas:

generate_case_number() - Genera n√∫meros de caso √∫nicos (formato: CASE-YYYYMMDD-XXXX)
update_updated_at_column() - Actualiza timestamp autom√°ticamente


ü§ñ Bot de Telegram
Flujo Conversacional (17 Estados):

Inicio - Mensaje de bienvenida
Tipo de Delito - Selecci√≥n con teclado personalizado
Datos Personales:

Nombre completo
N√∫mero de c√©dula
Edad (validaci√≥n num√©rica)
Profesi√≥n
Lugar de residencia (ciudad, pa√≠s)


Detalles del Incidente:

Descripci√≥n detallada (personalizada seg√∫n tipo de delito)
Fecha y hora del incidente
N√∫mero sospechoso (si aplica)
Monto perdido (validaci√≥n num√©rica)
Entidad bancaria (si aplica)
¬øComparti√≥ c√≥digo OTP? (S√≠/No)
¬øRealiz√≥ transferencias? (S√≠/No)
Aplicaci√≥n comprometida
Dispositivo afectado


Evidencias:

Opci√≥n de subir capturas de pantalla
Documentos
M√∫ltiples archivos


Confirmaci√≥n:

Resumen completo del caso
Validaci√≥n final
Generaci√≥n de n√∫mero de caso


Gu√≠a Inmediata:

Recomendaciones personalizadas seg√∫n tipo de delito
Acciones urgentes
Pasos de preservaci√≥n de evidencia
Informaci√≥n sobre denuncia formal



Caracter√≠sticas del Bot:

Validaci√≥n de datos en tiempo real
Mensajes contextuales seg√∫n tipo de delito
Registro de todas las interacciones
Actualizaci√≥n de sesiones activas
Manejo de errores robusto
Comandos: /start, /nuevo_caso, /cancel


üöÄ API Backend (FastAPI)
Endpoints Principales:
Estad√≠sticas:

GET /api/stats - Estad√≠sticas generales del dashboard
GET /api/estadisticas-avanzadas - M√©tricas detalladas

Casos:

GET /api/casos-por-tipo - Distribuci√≥n por tipo de delito
GET /api/casos-recientes?limit=50 - Casos m√°s recientes
GET /api/casos-por-fecha?dias=30 - Timeline de casos
GET /api/casos-por-ciudad?limit=10 - Casos por ubicaci√≥n
GET /api/caso/{numero_caso} - Detalle completo de un caso
PUT /api/caso/{numero_caso}/estado - Actualizar estado

Usuarios:

GET /api/usuarios-activos - Usuarios conectados (√∫ltimos 5 min)

N√∫meros Reportados:

GET /api/top-numeros-reportados - Top n√∫meros maliciosos
GET /api/buscar-numero/{numero} - Buscar si un n√∫mero fue reportado

WebSocket:

WS /ws/dashboard - Conexi√≥n para actualizaciones en tiempo real

Caracter√≠sticas:

CORS configurado para permitir frontend
Pool de conexiones a PostgreSQL
Validaci√≥n con Pydantic
Actualizaci√≥n en tiempo real v√≠a WebSockets
Manejo de errores HTTP apropiado
Documentaci√≥n autom√°tica en /docs


üìä Dashboard Web (React)
Componentes Visuales:
KPIs Principales (Cards):

Total usuarios registrados
Total casos
Usuarios activos en tiempo real
Casos nuevos hoy
Casos en proceso
P√©rdidas monetarias totales
Casos resueltos

Gr√°ficos:

Pie Chart: Distribuci√≥n de casos por tipo de delito
Line Chart: Tendencia de casos en √∫ltimos 7 d√≠as
Bar Chart: Casos por ciudad

Tablas en Tiempo Real:

Usuarios activos (√∫ltimos 5 minutos)

Nombre, estado de conversaci√≥n, √∫ltima actividad
Indicador visual de actividad (pulso verde)


Casos recientes (√∫ltimos 10)

N√∫mero de caso, usuario, tipo, estado
Descripci√≥n resumida, monto perdido
Badges de colores seg√∫n estado


Top n√∫meros reportados (8 m√°s reportados)

N√∫mero, veces reportado, tipo de fraude



Caracter√≠sticas:

Actualizaci√≥n autom√°tica cada 5 segundos
Dise√±o responsive (Tailwind CSS)
Tema oscuro con efectos glassmorphism
Animaciones suaves
Indicadores visuales de estado en vivo
Traducci√≥n de tipos y estados al espa√±ol


üê≥ Despliegue con Docker
Contenedores:

postgres - Base de datos PostgreSQL 14

Volumen persistente para datos
Inicializaci√≥n autom√°tica con schema.sql
Health check configurado


api - Backend FastAPI

Construido desde Dockerfile.api
Expone puerto 8000
Conecta con postgres
Vol√∫menes: uploads, logs


bot - Bot de Telegram

Construido desde Dockerfile.bot
Conecta con postgres y api
Vol√∫menes: uploads, logs
Reinicio autom√°tico


dashboard - Frontend con Nginx

Sirve archivos est√°ticos
Proxy inverso para API
WebSocket habilitado
Expone puerto 80



Redes:

Red interna delitos_network tipo bridge


‚öôÔ∏è Configuraci√≥n
Variables de Entorno (.env):
